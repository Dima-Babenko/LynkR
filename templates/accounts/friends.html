{% extends 'base.html' %}
{% block content %}

<style>
  .friends-container {
    max-width: 900px;
    margin: 40px auto;
    background-color: #2f3136; /* —Ç–µ–º–Ω–∏–π —Ñ–æ–Ω –¥–ª—è –±–ª–æ–∫—É */
    color: #d1d3d6;
    padding: 35px 40px;
    border-radius: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    box-shadow:
      0 10px 30px rgba(0,0,0,0.8),
      inset 0 0 25px #1a1c1f;
  }

  h2, h3 {
    color: #e0e2e6;
    font-weight: 700;
    margin-bottom: 28px;
    letter-spacing: 0.04em;
    text-shadow: 0 0 6px #5865f2;
  }

  ul {
    list-style: none;
    padding-left: 0;
    margin-bottom: 40px;
  }

  ul li {
    background: #36393f;
    padding: 16px 22px;
    margin-bottom: 14px;
    border-radius: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
    color: #b9bbbe;
    box-shadow: 0 4px 12px rgba(0,0,0,0.35);
    transition:
      background-color 0.3s ease,
      transform 0.15s ease,
      box-shadow 0.3s ease;
    cursor: default;
  }

  ul li:hover {
    background: #40444b;
    transform: translateY(-4px);
    box-shadow: 0 8px 18px rgba(88,101,242,0.7);
    color: #e3e5e8;
  }

  .user-id {
    font-weight: 400;
    font-style: italic;
    font-size: 0.9rem;
    opacity: 0.5;
    user-select: none;
  }

  form.inline-form {
    display: inline;
    margin-left: 12px;
  }

  button, input[type="submit"] {
    cursor: pointer;
    background: #5865f2;
    color: #fff;
    border: none;
    padding: 8px 20px;
    border-radius: 25px;
    font-weight: 700;
    font-size: 0.95rem;
    letter-spacing: 0.02em;
    box-shadow:
      0 6px 12px rgba(88,101,242,0.9);
    transition:
      background-color 0.3s ease,
      box-shadow 0.3s ease,
      transform 0.2s ease;
    user-select: none;
  }

  button:hover, input[type="submit"]:hover {
    background-color: #4752c4;
    box-shadow:
      0 8px 16px rgba(71,82,196,1);
    transform: translateY(-3px);
  }

  input[type="text"] {
    width: 72%;
    padding: 12px 16px;
    border-radius: 25px;
    border: none;
    background-color: #202225;
    color: #d1d3d6;
    font-size: 1.1rem;
    font-weight: 600;
    box-shadow:
      inset 0 0 8px #101113;
    transition: box-shadow 0.3s ease;
  }

  input[type="text"]:focus {
    outline: none;
    box-shadow:
      0 0 12px #5865f2,
      inset 0 0 12px #5865f2;
  }

  p.status {
    font-weight: 700;
    margin-top: 12px;
    margin-bottom: 25px;
    color: #43b581; /* –∑–µ–ª–µ–Ω–∏–π */
    text-shadow: 0 0 5px #2f7a4f;
  }

  p.status.warning {
    color: #faa61a; /* –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π */
    text-shadow: 0 0 5px #a76a0e;
  }

  hr {
    border: none;
    height: 1px;
    background: #393c43;
    margin: 40px 0;
    box-shadow: 0 1px 2px #22252a;
  }
</style>

<div class="friends-container">

  <h2>–î—Ä—É–∑—ñ</h2>
  {% if friends %}
  <ul>
      {% for friend in friends %}
          <li>{{ friend.username }} <span style="opacity:0.7;">({{ friend.friend_id }})</span></li>
      {% endfor %}
  </ul>
  {% else %}
  <p>–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –¥—Ä—É–∑—ñ–≤.</p>
  {% endif %}

  <hr>

  <h3>–ó–Ω–∞–π—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ friend ID</h3>
  <form method="get" action="{% url 'friends' %}">
      <input type="text" name="friend_id" placeholder="–í–≤–µ–¥—ñ—Ç—å friend ID" autocomplete="off" required>
      <button type="submit">–ó–Ω–∞–π—Ç–∏</button>
  </form>

  {% if found_user %}
      <hr>
      <h3>–ó–Ω–∞–π–¥–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á:</h3>
      <p><strong>{{ found_user.username }}</strong> <span style="opacity:0.7;">({{ found_user.friend_id }})</span></p>

      {% if already_friends %}
          <p class="status">‚úÖ –í–∏ –≤–∂–µ –¥—Ä—É–∑—ñ!</p>
      {% elif already_subscribed %}
          <p class="status warning">üîî –í–∏ –≤–∂–µ –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ –Ω–∞ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –û—á—ñ–∫—É—î—Ç—å—Å—è –ø—ñ–¥–ø–∏—Å–∫–∞ —É –≤—ñ–¥–ø–æ–≤—ñ–¥—å.</p>
      {% else %}
          <form method="post" action="{% url 'subscribe' %}">
              {% csrf_token %}
              <input type="hidden" name="friend_id" value="{{ found_user.friend_id }}">
              <button type="submit">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å</button>
          </form>
      {% endif %}
  {% endif %}

  <hr>

  <h3>–í–∞—à—ñ –ø—ñ–¥–ø–∏—Å–∫–∏</h3>
  <ul>
      {% for sub in user.following.all %}
          <li>{{ sub.following.username }} <span style="opacity:0.7;">({{ sub.following.friend_id }})</span></li>
      {% empty %}
          <li>–ù–µ–º–∞—î –ø—ñ–¥–ø–∏—Å–æ–∫.</li>
      {% endfor %}
  </ul>

  <h3>–í–∞—à—ñ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫–∏</h3>
  <ul>
      {% for sub in user.followers.all %}
          <li>{{ sub.follower.username }} <span style="opacity:0.7;">({{ sub.follower.friend_id }})</span></li>
      {% empty %}
          <li>–ù–µ–º–∞—î –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤.</li>
      {% endfor %}
  </ul>

  <hr>
  <h3>–ü—ñ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –≤–∞—Å, –∞–ª–µ –≤–∏ —â–µ –Ω–µ –ø—ñ–¥–ø–∏—Å–∞–ª–∏—Å—å:</h3>
  <ul>
      {% for sub in user.followers.all %}
          {% if sub.follower.id not in following_ids %}
              <li>
                  {{ sub.follower.username }} <span style="opacity:0.7;">({{ sub.follower.friend_id }})</span>
                  <form method="post" action="{% url 'subscribe' %}" class="inline-form">
                      {% csrf_token %}
                      <input type="hidden" name="friend_id" value="{{ sub.follower.friend_id }}">
                      <button type="submit">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è —É –≤—ñ–¥–ø–æ–≤—ñ–¥—å</button>
                  </form>
              </li>
          {% endif %}
      {% empty %}
          <li>–ù–µ–º–∞—î –Ω–æ–≤–∏—Ö –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤.</li>
      {% endfor %}
  </ul>

</div>

{% endblock %}
